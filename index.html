<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment & Real Estate Comparison Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
            min-height: 100vh;
            padding: 2vw;
            color: #333;
        }

        .container {
            max-width: min(1400px, 95vw);
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 1.5rem;
            padding: min(4vw, 30px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: min(3vw, 30px);
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            font-weight: 300;
        }

        .input-section {
            background: #f8f9fa;
            padding: min(3vw, 25px);
            border-radius: 1rem;
            border-left: 5px solid #4CAF50;
            margin-bottom: min(3vw, 30px);
        }

        summary {
            cursor: pointer;
            padding: min(1.5vw, 12px);
            background: #e9ecef;
            border-radius: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: clamp(1rem, 3vw, 1.2rem);
        }

        .investment-section {
            background: #fff;
            padding: min(2.5vw, 20px);
            border-radius: 0.75rem;
            margin-bottom: min(2vw, 15px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
        }

        .investment-section.real-estate { border-left: 5px solid #FF9800; }

        .input-group { margin-bottom: min(2.5vw, 20px); }

        label {
            display: block;
            margin-bottom: min(1vw, 8px);
            font-weight: 500;
            color: #34495e;
            font-size: clamp(0.85rem, 2.8vw, 0.95rem);
        }

        input[type="number"], input[type="text"] {
            width: 100%;
            padding: min(1.5vw, 12px);
            border: 2px solid #e9ecef;
            border-radius: 8px;
        }

        .btn {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
            color: white;
            border: none;
            padding: min(1.5vw, 12px) min(3vw, 24px);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin-right: 10px;
        }

        /* --- STICKY COLUMN & TABLE STYLING --- */
        .yearly-breakdown-wrapper {
            overflow-x: auto;
            margin-top: min(2.5vw, 20px);
        }

        .breakdown-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            min-width: max-content; 
        }

        .breakdown-table th, .breakdown-table td {
            padding: min(1.5vw, 12px);
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            border-right: 1px solid #e9ecef;
            vertical-align: top;
        }

        .breakdown-table.yearly-comparative td {
            min-width: 200px; /* Increased to fit new Home Value line */
        }

        /* Freeze Header */
        .breakdown-table th {
            position: sticky;
            top: 0;
            z-index: 30;
        }

        /* Freeze Year Column */
        .breakdown-table .main-row th:first-child,
        .breakdown-table tbody tr td:first-child {
            position: sticky;
            left: 0;
            background-color: #f0f0f0; 
            z-index: 20; 
            min-width: 60px;
            max-width: 60px;
            border-right: 2px solid #ccc;
        }
        
        .breakdown-table .main-row th:first-child { z-index: 40; }

        /* Typography */
        .amount-line { display: block; font-weight: 600; font-size: 1.1em; margin-bottom: 2px; }
        .detail-line { display: block; font-size: 0.75em; margin-bottom: 6px; color: #666; }

        /* Data Colors */
        .home-value { color: #2c3e50; }
        .real-estate-equity { color: #03A9F4; }
        .principal-paid { color: #008080; }
        .mortgage-interest-paid { color: #e74c3c; }
        .negative { color: #e74c3c; }
        .positive { color: #28a745; }

        .toggle-group button {
            padding: 8px 15px;
            cursor: pointer;
        }
        .active { background: #4CAF50; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Investment & Real Estate Comparison</h1>

        <details class="input-section" open>
            <summary>Parameters</summary>
            <div class="input-group">
                <label>Time Period (Years)</label>
                <input type="number" id="time-period" value="25">
            </div>

            <div id="investments-container">
                <div class="investment-section etf-section">
                    <h3>Investment #1 (ETF)</h3>
                    <input type="hidden" class="investment-type" value="ETF">
                    <input type="text" class="investment-name" value="S&P 500 ETF">
                    <label>Initial Investment ($)</label><input type="number" class="initial-investment" value="50000">
                    <label>Annual Contribution ($)</label><input type="number" class="annual-contribution" value="6000">
                    <label>Return (%)</label><input type="number" class="annual-return" value="10">
                    <input type="hidden" class="expense-ratio" value="0.03">
                </div>

                <div class="investment-section real-estate">
                    <h3>Investment #2 (Real Estate)</h3>
                    <input type="hidden" class="investment-type" value="Real Estate">
                    <input type="text" class="investment-name" value="Primary Residence">
                    <label>Property Value ($)</label><input type="number" class="property-value" value="300000">
                    <label>Down Payment (%)</label><input type="number" class="down-payment-percent" value="20">
                    <label>Interest Rate (%)</label><input type="number" class="loan-interest-rate" value="6.5">
                    <label>Appreciation (%)</label><input type="number" class="annual-appreciation" value="4">
                    <label>Expenses (%)</label><input type="number" class="annual-expenses-percent" value="1.5">
                    <input type="hidden" class="mortgage-term" value="25">
                </div>
            </div>
            <button class="btn" onclick="calculateCompounding()">Calculate</button>
        </details>

        <div class="results-section">
            <canvas id="growth-chart" style="max-height: 300px;"></canvas>
            <div id="results-content"></div>
        </div>
    </div>

    <script>
        let chartInstance = null;

        function getVal(el) { return el ? (parseFloat(el.value) || 0) : 0; }

        function calculateCompounding() {
            const tp = getVal(document.getElementById('time-period'));
            const results = [];
            
            document.querySelectorAll('.investment-section').forEach(sec => {
                const type = sec.querySelector('.investment-type').value;
                const name = sec.querySelector('.investment-name').value;
                
                if (type === 'Real Estate') {
                    results.push({ name, type, ...calculateRealEstate(sec, tp) });
                } else {
                    results.push({ name, type, ...calculateETF(sec, tp) });
                }
            });

            displayResults(results);
        }

        function calculateETF(sec, tp) {
            let val = getVal(sec.querySelector('.initial-investment'));
            const cont = getVal(sec.querySelector('.annual-contribution'));
            const rate = getVal(sec.querySelector('.annual-return')) / 100;
            let breakdown = [];
            for (let y = 1; y <= tp; y++) {
                let interest = (val + cont) * rate;
                val += cont + interest;
                breakdown.push({ year: y, endValue: val, growth: interest, contribution: cont });
            }
            return { yearlyBreakdown: breakdown };
        }

        function calculateRealEstate(sec, tp) {
            let propVal = getVal(sec.querySelector('.property-value'));
            const down = propVal * (getVal(sec.querySelector('.down-payment-percent')) / 100);
            const rate = getVal(sec.querySelector('.loan-interest-rate')) / 100 / 12;
            const appr = getVal(sec.querySelector('.annual-appreciation')) / 100;
            const expRate = getVal(sec.querySelector('.annual-expenses-percent')) / 100;
            let balance = propVal - down;
            const mPay = balance * (rate * Math.pow(1+rate, 300)) / (Math.pow(1+rate, 300) - 1);
            
            let breakdown = [];
            for (let y = 1; y <= tp; y++) {
                let yAppr = propVal * appr;
                propVal += yAppr;
                let yPrin = 0, yInt = 0;
                for (let m = 0; m < 12; m++) {
                    let mInt = balance * rate;
                    let mPrin = mPay - mInt;
                    balance -= mPrin;
                    yPrin += mPrin;
                    yInt += mInt;
                }
                breakdown.push({
                    year: y,
                    propertyValue: propVal,
                    currentEquity: propVal - balance,
                    annualPrincipalPaid: yPrin,
                    annualInterestPaid: yInt,
                    propertyAppreciation: yAppr,
                    netCashflow: -(mPay * 12 + (propVal * expRate))
                });
            }
            return { yearlyBreakdown: breakdown };
        }

        function formatCurrency(num) { return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(num); }

        function displayResults(results) {
            const content = document.getElementById('results-content');
            let table = `<div class="yearly-breakdown-wrapper"><table class="breakdown-table yearly-comparative"><thead><tr class="main-row"><th rowspan="2">Year</th>`;
            
            results.forEach(res => {
                let color = res.type === 'Real Estate' ? '#FF9800' : '#4CAF50';
                table += `<th colspan="2" style="background:${color};color:white">${res.name}</th>`;
            });
            table += `</tr><tr class="sub-row">`;
            results.forEach(res => table += res.type === 'Real Estate' ? `<th>Value / Equity / Cashflow</th><th>Debt / Principal Breakdown</th>` : `<th>Balance</th><th>Growth / Contribution</th>`);
            table += `</tr></thead><tbody>`;

            for (let y = 0; y < results[0].yearlyBreakdown.length; y++) {
                table += `<tr><td>${y+1}</td>`;
                results.forEach(res => {
                    const d = res.yearlyBreakdown[y];
                    if (res.type === 'Real Estate') {
                        table += `<td>
                                    <span class="amount-line home-value">${formatCurrency(d.propertyValue)}</span><span class="detail-line">Home Value</span>
                                    <span class="amount-line real-estate-equity">${formatCurrency(d.currentEquity)}</span><span class="detail-line">Equity</span>
                                    <span class="amount-line negative">${formatCurrency(d.netCashflow)}</span><span class="detail-line">Annual Cashflow</span>
                                  </td>
                                  <td>
                                    <span class="amount-line principal-paid">${formatCurrency(d.annualPrincipalPaid)}</span><span class="detail-line">Principal Paid</span>
                                    <span class="amount-line mortgage-interest-paid">${formatCurrency(d.annualInterestPaid)}</span><span class="detail-line">Interest Paid</span>
                                    <span class="amount-line positive">${formatCurrency(d.propertyAppreciation)}</span><span class="detail-line">Appreciation</span>
                                  </td>`;
                    } else {
                        table += `<td><span class="amount-line">${formatCurrency(d.endValue)}</span><span class="detail-line">Balance</span></td>
                                  <td><span class="amount-line positive">${formatCurrency(d.growth)}</span><span class="detail-line">Growth</span>
                                      <span class="amount-line">${formatCurrency(d.contribution)}</span><span class="detail-line">Contribution</span></td>`;
                    }
                });
                table += `</tr>`;
            }
            content.innerHTML = table + `</tbody></table></div>`;
            renderChart(results);
        }

        function renderChart(results) {
            const ctx = document.getElementById('growth-chart').getContext('2d');
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: results[0].yearlyBreakdown.map(d => `Year ${d.year}`),
                    datasets: results.map((res, i) => ({
                        label: res.name + (res.type === 'Real Estate' ? ' (Equity)' : ''),
                        data: res.yearlyBreakdown.map(d => res.type === 'Real Estate' ? d.currentEquity : d.endValue),
                        borderColor: res.type === 'Real Estate' ? 'orange' : (i === 0 ? 'green' : 'blue'),
                        fill: false
                    }))
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }
    </script>
</body>
</html>
